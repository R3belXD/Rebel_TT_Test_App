<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ðŸ‘‘_Test_ðŸ‘‘</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: transparent; color: #f0f0f0; }
  header { background: rgba(35,39,43,0.85); padding: 1rem; text-align: center; font-size: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); }
  #dataDisplay { background: rgba(35,39,43,0.7); margin: 1rem; padding: 1rem; border-radius: 12px; min-height: 120px; box-shadow: 0 2px 8px rgba(0,0,0,0.10); display:none; }
  #controls { margin: 1rem; display: flex; flex-wrap: wrap; gap: 1rem; background: transparent; }
  .control-group { background: rgba(35,39,43,0.7); padding: 1rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.10); }
  label { display: block; margin-bottom: 0.5rem; font-weight: 600; letter-spacing: 0.5px; }
  input, button { margin-bottom: 0.5rem; background: rgba(24,28,32,0.5); color: #f0f0f0; border: 1px solid #444; border-radius: 6px; padding: 0.4rem 0.7rem; font-size: 1rem; transition: border 0.2s, box-shadow 0.2s; }
  input:focus, button:focus { outline: none; border: 1.5px solid #2d8cf0; box-shadow: 0 0 0 2px rgba(45,140,240,0.15); }
  button { background: rgba(45,140,240,0.5); color: #fff; border: 1px solid #2d8cf0; padding: 0.5rem 1.2rem; cursor: pointer; font-weight: 600; letter-spacing: 0.5px; box-shadow: 0 1px 4px rgba(45,140,240,0.10); }
  button:hover { background: rgba(26,115,232,0.7); }
  #debugPanel {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      max-height: 20vh;
      overflow-y: auto;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      font-size: 0.9em;
      padding: 0.5em;
      z-index: 10000;
  }
  /* XP Earned popup styles */
  #xpEarnedPopup {
      position: fixed;
      background: rgba(26, 148, 2, 0.9);
      color: #f1efef;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1rem;
      opacity: 0;
      pointer-events: none;
      z-index: 99999;
      transition: opacity 0.5s, transform 0.5s;
  }
  /* Level progress bar styles */
  #levelProgressContainer {
    margin: 20px auto;
    max-width: 400px;
    height: 30px;
    background: rgba(35,39,43,0.7);
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    display: none; /* Hidden by default, toggle with checkbox */
  }
  #levelProgressBar {
    height: 100%;
    width: 0%;
    background: linear-gradient(to right, cyan, purple);
    border-radius: 8px 0 0 8px;
    transition: width 0.3s ease;
  }
  #levelProgressText {
    position: absolute;
    top: 0; left: 50%;
    transform: translateX(-50%);
    height: 100%;
    display: flex; align-items: center; justify-content: center;
    font-weight: bold; color: #f0f0f0;
  }
</style>
</head>
<body>

<!-- Main overlay box with gradient border -->
<div id="walletOverlay" style="
  display:none;
  position:fixed;
  top:10vh;
  left:10vw;
  width:220px;
  min-height:60px;
  max-height:30vh;
  background:rgba(30,30,30,0.92);
  color:#fff;
  z-index:9999;
  overflow:auto;
  padding:1rem 1.2rem;
  font-size:1.2rem;
  border-radius:10px;
  box-shadow:0 4px 24px rgba(0,0,0,0.25);
  border: 4px solid transparent;
  border-image: linear-gradient(to right, cyan, purple) 1;">
</div>

<!-- Transparency and options controls -->
<div id="walletTransparencyControl" style="
  display:none;
  position:fixed;
  top:calc(10vh + 34px);
  left:10vw;
  width:200px;
  z-index:10000;
  padding:0.5rem 0.7rem 0.7rem 0.7rem;
  background:rgba(35,39,43,0.7);
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.10);
  font-size:1em;
  overflow:hidden;
  border:1px solid black;">
    <label for="walletTransparencySlider" style="color:#fff;font-weight:600;">Transparency</label>
    <input type="range" id="walletTransparencySlider" min="0.2" max="1" step="0.01" value="0.92" style="width: calc(100% - 32px); margin: 32 0px;">
    <div id="overlayOptionsPanel" style="margin-top:0.7em;">
        <label style="color:#fff;"><input type="checkbox" id="showWallet"/> Wallet</label>
        <label style="color:#fff;"><input type="checkbox" id="showLevelBar"/> Show Level Bar</label>
        <label style="color:#fff;"><input type="checkbox" id="showLevel"/> Level</label>
        <label style="color:#fff;"><input type="checkbox" id="showXPPercent"/> XP %</label>
        <label style="color:#fff;"><input type="checkbox" id="showRawXP"/> Total XP</label>
        <label style="color:#fff;"><input type="checkbox" id="showBonusXP"/> Bonus XP</label>
        <label style="color:#fff;"><input type="checkbox" id="showJob"/> Job</label>
        <label style="color:#fff;"><input type="checkbox" id="showExpEarned"/> EXP Earned</label>
    </div>
</div>

<!-- Level progress bar container -->
<div id="levelProgressContainer">
  <div id="levelProgressBar"></div>
  <div id="levelProgressText">Current Lvl: 00/00</div>
</div>

<!-- Popup for EXP Earned floating notification -->
<div id="xpEarnedPopup"></div>

<script>
(function() {
  // --- Your existing data and functions start here ---
  // Example job map (if needed)
  const jobExpTokenMap = [
    { jobName: "EMS / Paramedic", itemId: "exp_token_a|ems|ems" },
    { jobName: "Firefighter", itemId: "exp_token_a|ems|fire" },
    { jobName: "Farmer", itemId: "exp_token_a|farming|farming" },
    { jobName: "Fisherman", itemId: "exp_token_a|farming|fishing" },
    { jobName: "Miner", itemId: "exp_token_a|farming|mining" },
    { jobName: "Wildlife Hunter", itemId: "exp_token_a|hunting|skill" },
    { jobName: "Cargo Pilot", itemId: "exp_token_a|piloting|cargos" },
    { jobName: "Helicopter Pilot", itemId: "exp_token_a|piloting|heli" },
    { jobName: "Airline Pilot", itemId: "exp_token_a|piloting|piloting" },
    { jobName: "Street Racer", itemId: "exp_token_a|player|racing" },
    { jobName: "Bus Driver", itemId: "exp_token_a|train|bus" },
    { jobName: "Train Conductor", itemId: "exp_token_a|train|train" },
    { jobName: "Garbage Collector", itemId: "exp_token_a|trucking|garbage" },
    { jobName: "Mechanic", itemId: "exp_token_a|trucking|mechanic" },
    { jobName: "PostOP Driver", itemId: "exp_token_a|trucking|postop" },
    { jobName: "Trucker", itemId: "exp_token_a|trucking|trucking" }
  ];

  // XP to level formula
  function xpForLevel(level) {
    return (5/2) * level * (level +1);
  }

  // Variables
  let currentXP = 0;
  let currentLevel = 0;

  // Handle "Show Level Bar" toggle
  const levelBarCheckbox = document.getElementById('showLevelBar');
  const levelProgressContainer = document.getElementById('levelProgressContainer');

  function toggleLevelBar() {
    levelProgressContainer.style.display = levelBarCheckbox.checked ? 'block' : 'none';
  }
  levelBarCheckbox.addEventListener('change', toggleLevelBar);

  // Function to update progress bar
  function updateLevelProgressBar(xp, level) {
    if (!xp || level < 0) {
      document.getElementById('levelProgressBar').style.width = '0%';
      document.getElementById('levelProgressText').textContent = 'Current Lvl: --/--';
      return;
    }
    const currentXPThreshold = xpForLevel(level);
    const nextXPThreshold = xpForLevel(level + 1);
    const progressPercent = Math.min(
      100,
      Math.max(0, ((xp - currentXPThreshold) / (nextXPThreshold - currentXPThreshold)) * 100)
    );
    document.getElementById('levelProgressBar').style.width = progressPercent + '%';
    document.getElementById('levelProgressText').textContent = `Current Lvl: ${level} / ${level + 1}`;
  }

  // --- Your existing code for data extraction, overlay updates, message handling, etc. ---
  // For demonstration, create a function to simulate XP gain
  window.simulateXP = function(amount) {
    currentXP += amount;
    currentLevel = Math.floor((Math.sqrt(1 + 8 * currentXP / 5) - 1) / 2);
    // For demo, update some display
    // Assuming you have elements to show total XP and job name
    if (!document.getElementById('exp')) {
      const p = document.createElement('p');
      p.id = 'exp';
      document.body.appendChild(p);
    }
    document.getElementById('exp').textContent = 'EXP: ' + currentXP;
    // For demo, set job name
    if (!document.getElementById('job')) {
      const p = document.createElement('p');
      p.id = 'job';
      document.body.appendChild(p);
    }
    document.getElementById('job').textContent = 'Job: Warrior'; // example
    updateLevelProgressBar(currentXP, currentLevel);
  };

  // Initialize with zero XP
  simulateXP(0);

  // --- Your existing message event listener, data extraction, overlay update logic goes here ---
  // For demonstration, you can simulate data updates or integrate your existing code

  // For testing, add buttons to simulate XP gains
})();
</script>

<div style="text-align:center; margin-top:20px;">
  <button onclick="simulateXP(200)">Add 200 XP</button>
  <button onclick="simulateXP(500)">Add 500 XP</button>
  <button onclick="simulateXP(1500)">Add 1500 XP</button>
</div>

</body>
</html>
