<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üëë_ùï≠ùñéùñôùñç_üëë</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: transparent; color: #f0f0f0; }

#walletOverlay {
  display:none;
  position:fixed;
  top:10vh;
  left:10vw;
  width:220px;
  min-height:60px;
  max-height:30vh;
  background:rgba(30,30,30,0.92);
  color:#fff;
  z-index:9999;
  overflow:auto;
  padding:1rem 1.2rem;
  font-size:1.2rem;
  border-radius:10px;
  box-shadow:0 4px 24px rgba(0,0,0,0.25);
  border: 4px solid transparent;
  border-image: linear-gradient(to right, cyan, purple) 1;
}

/* Toggle button style */
#apiToggleBtn {
  position: fixed; top: 2vh; left: 50%; transform: translateX(-50%);
  background:#222; color:#fff; padding:0.5em 1em; border-radius:5px; cursor:pointer; font-family:sans-serif; z-index:99999; font-size:1em;
}
</style>
</head>
<body>

<!-- Toggle Button -->
<div id="apiToggleBtn">Switch to Beta API</div>

<!-- Your overlay -->
<div id="walletOverlay"></div>

<script>
(function() {
  // API URLs
  const mainApi = 'http://v1.api.tycoon.community/main/';
  const betaApi = 'http://v1.api.tycoon.community/beta/';
  let useBeta = false; // start with main

  const toggleBtn = document.getElementById('apiToggleBtn');
  toggleBtn.onclick = () => {
    useBeta = !useBeta;
    toggleBtn.textContent = useBeta ? 'Switch to Main API' : 'Switch to Beta API';
  };

  // Your existing overlay styles and functions...
  const overlay = document.getElementById('walletOverlay');

  // Make draggable
  function makeDraggable(el) {
    let isDragging = false, offsetX=0, offsetY=0;
    el.addEventListener('mousedown', e => {
      isDragging=true; offsetX=e.clientX - el.offsetLeft; offsetY=e.clientY - el.offsetTop; el.style.cursor='grabbing';
    });
    document.addEventListener('mousemove', e => {
      if (isDragging) {
        el.style.left = (e.clientX - offsetX)+'px';
        el.style.top = (e.clientY - offsetY)+'px';
      }
    });
    document.addEventListener('mouseup', () => {
      if (isDragging) { isDragging=false; el.style.cursor='move'; }
    });
  }
  makeDraggable(overlay);

  // Your overlay styling and position restore
  function restoreOverlayPosition() {
    const saved = localStorage.getItem('overlayPos_walletOverlay');
    if (saved) {
      try {
        const pos = JSON.parse(saved);
        if (pos.left) overlay.style.left = pos.left;
        if (pos.top) overlay.style.top = pos.top;
      } catch(e){ }
    } else {
      overlay.style.left='10vw'; overlay.style.top='10vh';
    }
  }
  restoreOverlayPosition();

  // Save position on drag end
  overlay.addEventListener('mouseup', () => {
    localStorage.setItem('overlayPos_walletOverlay', JSON.stringify({left: overlay.style.left, top: overlay.style.top}));
  });

  // Your job map
  const jobExpTokenMap = [
    { jobName: "EMS / Paramedic", itemId: "exp_token_a|ems|ems" },
    { jobName: "Firefighter", itemId: "exp_token_a|ems|fire" },
    { jobName: "Farmer", itemId: "exp_token_a|farming|farming" },
    { jobName: "Fisherman", itemId: "exp_token_a|farming|fishing" },
    { jobName: "Miner", itemId: "exp_token_a|farming|mining" },
    { jobName: "Wildlife Hunter", itemId: "exp_token_a|hunting|skill" },
    { jobName: "Cargo Pilot", itemId: "exp_token_a|piloting|cargos" },
    { jobName: "Helicopter Pilot", itemId: "exp_token_a|piloting|heli" },
    { jobName: "Airline Pilot", itemId: "exp_token_a|piloting|piloting" },
    { jobName: "Street Racer", itemId: "exp_token_a|player|racing" },
    { jobName: "Bus Driver", itemId: "exp_token_a|train|bus" },
    { jobName: "Train Conductor", itemId: "exp_token_a|train|train" },
    { jobName: "Garbage Collector", itemId: "exp_token_a|trucking|garbage" },
    { jobName: "Mechanic", itemId: "exp_token_a|trucking|mechanic" },
    { jobName: "PostOP Driver", itemId: "exp_token_a|trucking|postop" },
    { jobName: "Trucker", itemId: "exp_token_a|trucking|trucking" }
  ];

  // Fetch and process data
  function fetchData() {
    const url = useBeta ? betaApi : mainApi;
    fetch(url)
      .then(res => res.json())
      .then(data => {
        console.log('Data:', data);
        processData(data);
      })
      .catch(e => console.error('Error fetching:', e));
  }

  function processData(data) {
    const xp = (typeof data.xp !== 'undefined') ? Number(data.xp) : null;
    const wallet = (typeof data.wallet !== 'undefined') ? Number(data.wallet) : null;
    const jobName = (typeof data.job_name !== 'undefined') ? data.job_name : '';

    // Find bonus XP in inventory
    let bonusXP = null;
    if (data.inventory && typeof data.inventory==='object') {
      const inv = data.inventory;
      const jobEntry = jobExpTokenMap.find(e => e.jobName.toLowerCase()===jobName.toLowerCase());
      if (jobEntry) {
        const itemId=jobEntry.itemId;
        if (inv[itemId] && typeof inv[itemId].amount==='number') {
          bonusXP=inv[itemId].amount;
        }
      }
    }

    updateOverlay(wallet, xp, bonusXP, jobName);
  }

  function updateOverlay(wallet, xp, bonusXP, jobName) {
    overlay.innerHTML='';
    overlay.dataset.wallet=wallet!=null?wallet:'';
    overlay.dataset.jobName=jobName;

    // Wallet display
    overlay.innerHTML+=`<b>Wallet:</b> <span style="font-size:1.3em;color:#7cff7c;">${formatWallet(wallet)}</span><br>`;
    // XP
    overlay.innerHTML+=`<b>Total XP:</b> <span style="font-size:1.3em;color:#ffd700;">${xp!=null?Math.floor(xp).toLocaleString():'N/A'}</span><br>`;
    // Level
    if (xp!=null && !isNaN(xp)) {
      const lvl=Math.floor((Math.sqrt(1+8*xp/5)-1)/2);
      overlay.innerHTML+=`<b>Level:</b> <span style="font-size:1.3em;color:#b0e0e6;">${lvl>=0?lvl:'N/A'}</span>`;
    } else {
      overlay.innerHTML+=`<b>Level:</b> <span style="font-size:1.3em;color:#b0e0e6;">N/A</span>`;
    }
    // % to 1m XP
    let perc=0;
    if (xp!=null && !isNaN(xp)) {
      perc= xp<=1000000 ? (xp/1000000)*100 : ((xp-1000000)/9000000)*100;
      perc=Math.min(100,perc);
    }
    overlay.innerHTML+=`<b>% to 1m XP:</b> <span style="font-size:1.3em;color:#8cf0ff;">${perc.toFixed(2)}%</span>`;
    // Job
    overlay.innerHTML+=`<br><b>Job:</b> <span style='font-size:1.3em;color:#ffa07a;'>${jobName||'N/A'}</span>`;
    overlay.style.display='block';
  }

  // Periodically fetch data
  setInterval(fetchData, 5000);
  fetchData();

})();
</script>

</body>
</html>
