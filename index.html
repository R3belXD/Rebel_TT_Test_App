<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>XP & Job Overlay Demo</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #222; color: #f0f0f0; }
  #walletOverlay {
    position: fixed;
    top: 10vh;
    left: 10vw;
    width: 250px;
    background: rgba(30,30,30,0.92);
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.25);
    border: 4px solid transparent;
    border-image: linear-gradient(to right, cyan, purple) 1;
    font-size: 1.2rem;
    z-index: 9999;
  }
  /* optional: style for controls to test data changes */
  #controls {
    position: fixed;
    bottom: 0;
    left: 0;
    background: rgba(0,0,0,0.8);
    padding: 10px;
    display: flex;
    gap: 10px;
    font-size: 0.9em;
  }
  button { padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
</style>
</head>
<body>

<div id="walletOverlay" style="display:none;">
  <!-- Content will be generated dynamically -->
</div>

<!-- Optional controls to simulate changing data -->
<div id="controls">
  <button onclick="simulateData('job', 'Farmer')">Set Job: Farmer</button>
  <button onclick="simulateData('xp', 500000)">XP: 500,000</button>
  <button onclick="simulateData('xp', 2_000_000)">XP: 2,000,000</button>
  <button onclick="simulateData('wallet', 1234567)">Wallet: 1,234,567</button>
  <button onclick="simulateData('job', 'Firefighter')">Set Job: Firefighter</button>
  <button onclick="simulateData('xp', 750000)">XP: 750,000</button>
  <button onclick="simulateData('xp', 1500000)">XP: 1,500,000</button>
</div>

<script>
  // Sample data to simulate incoming updates
  let currentData = {
    job: 'Trucker',
    xp: 0,
    wallet: 0
  };

  // For toggle of label
  let showTo10Million = false;

  // Function to simulate data updates
  function simulateData(type, value) {
    if (type === 'job') {
      currentData.job = value;
    } else if (type === 'xp') {
      currentData.xp = value;
    } else if (type === 'wallet') {
      currentData.wallet = value;
    }
    updateOverlay();
  }

  // Utility for formatting wallet
  function formatWallet(val) {
    if (val == null || isNaN(val)) return 'N/A';
    const abs = Math.abs(val);
    if (abs >= 1e12) return (val/1e12).toFixed(2) + 't';
    if (abs >= 1e9) return (val/1e9).toFixed(2) + 'b';
    if (abs >= 1e6) return (val/1e6).toFixed(2) + 'm';
    if (abs >= 1e3) return (val/1e3).toFixed(2) + 'k';
    return val.toLocaleString();
  }

  // Main update function
  function updateOverlay() {
    const overlay = document.getElementById('walletOverlay');
    overlay.style.display = 'block';

    const { job, xp, wallet } = currentData;

    // Determine xpVal based on xp
    let xpVal = xp;

    // Toggle label if xp crosses 1 million
    if (xpVal != null && xpVal >= 1_000_000 && !showTo10Million) {
      showTo10Million = true;
    }
    if (xpVal != null && xpVal < 1_000_000 && showTo10Million) {
      showTo10Million = false;
    }

    // Calculate % to 1m or 10m
    const maxXP = showTo10Million ? 10_000_000 : 1_000_000;
    const xpPercent = (xpVal != null && !isNaN(xpVal))
      ? Math.max(0, Math.min(100, (xpVal / maxXP) * 100))
      : 0;

    // Build overlay content
    const fields = [];

    // Show job
    if (job)
      fields.push(`<b>Job:</b> <span style='font-size:1.1em;color:#ffa07a;'>${job}</span>`);

    // Show level
    if (true) { // always show level for demo
      const level = (xpVal != null && !isNaN(xpVal))
        ? Math.floor((Math.sqrt(1 + 8 * xpVal / 5) - 1) / 2)
        : 'N/A';
      fields.push(`<b>Level:</b> <span style='font-size:1.1em;color:#b0e0e6;'>${level}</span>`);
    }

    // Bonus XP (not used in demo, so skipping)
    // Total XP
    if (xp != null)
      fields.push(`<b>Total XP:</b> <span style='font-size:1.1em;color:#ffb347;'>${xp.toLocaleString()}</span>`);

    // Percentage to 1m or 10m
    const label = showTo10Million ? "% to 10m" : "% to 1m";
    fields.push(`<b>${label}:</b> <span style='font-size:1.1em;color:#8cf0ff;'>${xpPercent.toFixed(2)}%</span>`);

    // Wallet
    fields.push(`<b>Wallet:</b> <span style='font-size:1.3em;color:#7cff7c;'>${formatWallet(wallet)}</span>`);

    // Set content
    overlay.innerHTML = fields.join('<br>');
  }

  // Initialize overlay on page load
  window.onload = () => {
    updateOverlay();
  };
</script>

</body>
</html>
